Index: mysql_dinggao.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import datetime\r\n\r\nfrom cffi.cparser import lock\r\n\r\n\r\n# 查询待定稿列表\r\ndef database_daidinggao(connection, cursor, userName):\r\n    lock.acquire()\r\n    # 执行数据查询\r\n    sql = \"select DISTINCT contract.name AS contractName, contract_state.time AS contractTime from contract,contract_state,user\" \\\r\n          \" where contract_state.con_id=contract.id and contract_state.type=2 and contract.use_id=(SELECT id FROM user WHERE name ='\" + userName + \"')\"\r\n    cursor.execute(sql)\r\n    # 获取数据库单条数据\r\n    result = cursor.fetchall()\r\n    connection.commit()\r\n    lock.release()\r\n    return result\r\n\r\n\r\n# 查询已定稿列表\r\ndef database_yidinggao(connection, cursor, userName):\r\n    lock.acquire()\r\n    # 执行数据查询\r\n    sql = \"select DISTINCT contract.name AS contractName, contract_state.time AS contractTime from contract,contract_state \" \\\r\n          \"where contract_state.id=contract.id and contract_state.type=3 and contract.use_id=(SELECT id FROM user \" \\\r\n          \"WHERE name ='\" + userName + \"') \"\r\n    cursor.execute(sql)\r\n    # 获取数据库单条数据\r\n    result = cursor.fetchall()\r\n    connection.commit()\r\n    lock.release()\r\n    return result\r\n\r\n\r\n# 定稿合同\r\ndef database_dinggao(connection, cursor, name, userName, dinggao):\r\n    lock.acquire()\r\n    timenum = datetime.datetime.strftime(datetime.datetime.now(), '%Y-%m-%d %H:%M:%S')\r\n\r\n    # 执行数据查询,查询是否全部会签\r\n    sql = \"SELECT use_id FROM contract_process WHERE contract_process.con_id=(SELECT id FROM contract WHERE name='\" + name + \"') and contract_process.type=1 and contract_process.state=0\"\r\n    cursor.execute(sql)\r\n    # 获取数据库单条数据\r\n    result = cursor.fetchone()\r\n    # 存在未会签用户\r\n    if result:\r\n        lock.release()\r\n        return 0\r\n    else:\r\n        # 更新数据\r\n        sql = \"UPDATE contract_state SET type='3',time='\" + timenum + \"' WHERE contract_state.con_id=(SELECT id FROM contract WHERE name='\" + name + \"') \"\r\n        cursor.execute(sql)\r\n        # 提交数据\r\n        connection.commit()\r\n        # 更新数据\r\n        sql = \"UPDATE contract SET content='\" + dinggao + \"' WHERE contract.name='\" + name + \"' and contract.use_id=(SELECT id FROM user WHERE name='\" + userName + \"')\"\r\n        cursor.execute(sql)\r\n        # 提交数据\r\n        connection.commit()\r\n        lock.release()\r\n        return 1
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/mysql_dinggao.py b/mysql_dinggao.py
--- a/mysql_dinggao.py	(revision bebbd73161a2f2f9c9ba37201adc8a30ab72b11a)
+++ b/mysql_dinggao.py	(date 1607842671183)
@@ -29,6 +29,7 @@
     result = cursor.fetchall()
     connection.commit()
     lock.release()
+    print(result)
     return result
 
 
